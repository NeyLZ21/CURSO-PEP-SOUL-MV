// Pon esto cerca de tus otros "const" globales:
const SKIP_TOLERANCE_SECONDS = 8;  // margen permitido antes de considerar que "adelantaron"

// Reemplaza tu startTick(pid, moduleId, videoId) por esta versión:
function startTick(pid, moduleId, videoId){
  stopTick(pid);
  const store = ensureStoreFor(moduleId, videoId);
  ticks[pid] = setInterval(()=>{
    const p = players[pid]; if(!p || !p.getDuration) return;

    const state = p.getPlayerState();
    const cur   = p.getCurrentTime() || 0;
    const dur   = p.getDuration()    || 0;

    if (dur && (!store.dur || Math.abs(store.dur - dur) > 0.5)) {
      store.dur = dur;
      throttleSaveProgress();
    }

    // ───── Anti-seek con tolerancia ─────────────────────────────
    // Permitimos pequeños "saltos" (jitter) sin rebobinar.
    // Solo rebobinamos si el adelanto supera el margen definido.
    if (cur > store.allow + SKIP_TOLERANCE_SECONDS) {
      // Adelanto grande → probablemente movieron la barra
      p.seekTo(store.allow, true);
      return;
    }

    // Si está reproduciendo, avanzamos "allow" de forma normal
    if (state === YT.PlayerState.PLAYING) {
      // Si hubo un pequeño salto (≤ tolerancia), lo aceptamos
      if (cur > store.allow) store.allow = cur;
      store.t = cur;
    } else {
      // Pausa/buffer: solo registramos posición
      store.t = cur;
    }
  }, 500);
}
