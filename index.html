<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Inducci√≥n a PEP-SOUL MV ‚Ä¢ Hospital Vozandes</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{--brand:#781C38;--ink:#1f2937;--muted:#6b7280;--bg:#f8fafc;--card:#ffffff;--ok:#15803d}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
.container{max-width:980px;margin:auto;padding:24px}
header{display:flex;gap:16px;align-items:center;margin:12px 0 20px}
header .logo{width:48px;height:48px;border-radius:12px;background:var(--brand);display:grid;place-content:center;color:#fff;font-weight:800}
h1{font-size:clamp(22px,3.5vw,34px);margin:0}.subtitle{color:var(--muted);margin-top:4px}
.card{background:var(--card);border-radius:18px;box-shadow:0 10px 24px rgba(0,0,0,.06);padding:20px}
.grid{display:grid;gap:16px}.grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
@media (max-width:800px){.grid.cols-2{grid-template-columns:1fr}}
button,.btn{appearance:none;border:0;border-radius:14px;padding:12px 16px;cursor:pointer;font-weight:600}
.btn-primary{background:var(--brand);color:#fff}.btn-muted{background:#e5e7eb;color:#111827}.btn-success{background:var(--ok);color:#fff}
.btn[disabled]{opacity:.5;cursor:not-allowed}
.muted{color:var(--muted)} .footer{margin-top:24px;color:var(--muted);font-size:13px}

/* Inputs */
.input-wrap{position:relative}
.input-wrap input, .input-wrap select, input, select {width:100%;padding:12px 40px 12px 12px;border-radius:12px;border:1px solid #e5e7eb}
.eye{position:absolute;right:8px;top:50%;transform:translateY(-50%);cursor:pointer;border:0;background:transparent;font-size:16px}

/* Combo de especialidad (igual que la referencia) */
.combo{position:relative}
.combo input{padding-right:36px}
.combo .arrow{position:absolute;right:10px;top:50%;transform:translateY(-50%);pointer-events:none}
.combo .panel{position:absolute;z-index:20;left:0;right:0;max-height:280px;overflow:auto;background:#111827;color:#f9fafb;border-radius:12px;padding:6px 0;box-shadow:0 10px 24px rgba(0,0,0,.18);display:none}
.combo .opt{padding:10px 12px;cursor:pointer}
.combo .opt[aria-selected="true"], .combo .opt:hover{background:#1f2937}
.combo.show .panel{display:block}

.alert{border-radius:12px;padding:12px 14px;font-size:14px}
.alert-warn{background:#fffbeb;border:1px solid #fde68a;color:#92400e}
.saving::after{content:'';display:inline-block;width:14px;height:14px;margin-left:8px;border:2px solid #9ca3af;border-top-color:transparent;border-radius:999px;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="container">
  <header class="no-print">
    <div class="logo">HVQ</div>
    <div style="flex:1">
      <h1>Inducci√≥n a Soul MV</h1>
      <div class="subtitle">Curso para nuevos m√©dicos ‚Ä¢ Hospital Vozandes</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <span id="auth-user" class="muted" style="font-size:13px"></span>
      <button id="btn-logout" class="btn btn-muted" style="display:none">Cerrar sesi√≥n</button>
    </div>
  </header>

  <!-- Acceso (simplificado para el ejemplo del combo) -->
  <section id="step-welcome" class="card no-print">
    <h2 style="margin:0 0 6px">Acceso</h2>
    <p class="muted" style="margin:0 0 14px">Inicia sesi√≥n o reg√≠strate. (Puedes omitir auth si solo pruebas el combo)</p>
    <div class="grid cols-2">
      <div>
        <div class="grid" id="auth-forms">
          <div id="form-login">
            <label>Correo electr√≥nico<br>
              <input id="login-email" type="email" placeholder="usuario@dominio.com" autocomplete="username email">
            </label>
            <label>Contrase√±a<br>
              <div class="input-wrap">
                <input id="login-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
                <button type="button" class="eye" data-eye="#login-pass">üëÅÔ∏è</button>
              </div>
            </label>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn btn-primary" id="btn-login" type="button">Confirmar</button>
            </div>
          </div>
          <div id="auth-msg" class="muted" style="min-height:18px"></div>
        </div>
      </div>

      <div class="card" style="background:#fff7f7;border:1px dashed #fda4af">
        <strong>Requisitos</strong>
        <ul style="margin:8px 0 0 18px">
          <li>Completar perfil</li>
          <li>Seleccionar especialidad desde el combo</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Perfil (con combo de especialidad) -->
  <section id="profile" class="card no-print" style="display:block;margin:18px 0">
    <h2 style="margin:0 0 8px">Mi perfil</h2>
    <p class="muted" id="pf-help">Completa todos los campos. La especialidad <strong>solo</strong> se puede cambiar al crear el perfil o presionando <em>Modificar</em>.</p>
    <div class="grid cols-2">
      <label>Nombre completo (para certificado)<br>
        <input id="pf-name" type="text" required>
      </label>
      <label>C√©dula o Pasaporte<br>
        <input id="pf-id" type="text" required>
      </label>

      <label style="grid-column:1/-1">Especialidad<br>
        <div class="combo" id="spec-combo">
          <input id="pf-spec" type="text" placeholder="Escribe para buscar‚Ä¶" autocomplete="off" readonly>
          <span class="arrow">‚ñæ</span>
          <div class="panel" id="spec-panel" role="listbox" aria-label="Especialidades"></div>
        </div>
        <small class="muted">Selecciona de la lista; no se permiten valores fuera del cat√°logo.</small>
      </label>
    </div>

    <div class="actions" style="display:flex;gap:8px;margin-top:10px">
      <button id="btn-edit-profile" class="btn btn-muted" style="display:none" type="button">Modificar</button>
      <button id="btn-save-profile" class="btn btn-primary" type="button">Guardar perfil</button>
    </div>
    <div id="pf-msg" class="muted" style="margin-top:6px"></div>
  </section>

  <div class="footer no-print">¬© <span id="year"></span> Hospital Vozandes ‚Äî Inducci√≥n Soul MV</div>
</div>

<script>
/* ======= ESPECIALIDADES EXACTAS (cat√°logo) ======= */
const ESPECIALIDADES=[ "ACUPUNTURA","ALERGOLOGIA","ANESTESIOLOGIA","CARDIOLOGIA","CARDIOLOGIA HEMODINAMIA","CARDIOLOGIA INTERVENCIONISTA","CARDIOLOGIA PEDIATRICA","CIR. GENERAL-COLOPROCTOLOGIA","CIR. MANO/MU√ëE-NERVIO PERI/BRA","CIRUGIA CARDIACA","CIRUGIA DE CABEZA Y CUELLO","CIRUGIA DE COLUMNA","CIRUGIA DE HOMBRO Y CODO","CIRUGIA GENERAL","CIRUGIA ONCOLOGICA","CIRUGIA PEDIATRICA","CIRUGIA PLASTICA","CIRUGIA TORACICA","CIRUGIA VASCULAR","COLOPROCTOLOGIA","CUIDADOS PALIATIVOS","DERMATOLOGIA","DIABETOLOGIA","EMERGENCIAS Y DESASTRES","ENDOCRINO PEDIATRA","ENDOCRINOLOGIA","ENFERMEDADES AUTOINMUNES","FISIATRIA","FONOAUDIOLOGIA","GASTROENTEROLOGIA","GASTROENTEROLOGIA PEDIATRICA","GENETICA MEDICA","GERIATRIA","GINECOLOGIA  INFANTO JUVENIL","GINECOLOGIA ONCOLOGICA","GINECOLOGIA Y OBSTETRICIA","HEMATOLOGIA","HEMATOLOGO ONCOLOGO PEDIATRIA","HEPATOLOGIA","INFECTOLOGIA","INFECTOLOGIA PEDIATRICA","INTERVENCIONISMO","MASTOLOGIA","MAXILO FACIAL","MEDICINA CRITICA","MEDICINA CRITICA PEDIATRICA","MEDICINA DEL DEPORTE","MEDICINA FAMILIAR","MEDICINA FAMILIAR EMERGENCIA","MEDICINA GENERAL","MEDICINA INTERNA","MEDICINA MATERNO FETAL","MEDICINA PALIATIVA","MICROBIOLOGIA","NEFROLOGIA","NEFROLOGIA PEDIATRICA","NEONATOLOGIA","NEUMOLOGIA","NEUMOLOGIA PEDIATRICA","NEUROCIRUGIA","NEUROFISIOLOGIA CLINICA","NEUROLOGIA","NEUROLOGIA PEDIATRICA","NEUROPSICOLOGIA","NEURORADIOL INTERVENCIONISTA","NEURORADIOLOGIA","NUTRICION","ODONTOLOGIA","ODONTOPEDIATRIA","OFTALMOLOGIA","OFTALMOLOGIA PEDIATRICA","ONCOLOGIA CLINICA","OTORRINOLARINGOLOGIA","PATOLOGIA","PEDIATRIA","PSICOLOGIA","PSIQUIATRIA","RADIOLOGIA","RADIOLOGIA INTERVENCIONISTA","RADIOTERAPIA","RESIDENTE/INTERNO","REUMATOLOGIA","REUMATOLOGIA PEDIATRICA","SEXOLOGIA","TRATAMIENTO DEL DOLOR","TRAUMATO PEDIATRICA DE COLUMNA","TRAUMATOLOGIA DEL COLUMNA","TRAUMATOLOGIA ONCOLOGICA","TRAUMATOLOGIA PEDIATRICA","TRAUMATOLOGIA Y ORTOPEDIA","UROLOGIA","UROLOGIA PEDIATRICA" ];

/* ======= Util ======= */
const $=s=>document.querySelector(s);
$('#year').textContent=new Date().getFullYear();

/* ======= Estado local m√≠nimo para el ejemplo ======= */
let state = { profile: {} };
let allowEditSpec = true; // Al crear perfil: true. Tras guardar, queda bloqueado hasta ‚ÄúModificar‚Äù.

/* ======= Ojo password (solo demo UI) ======= */
document.addEventListener('click',e=>{
  const t=e.target.closest('.eye'); if(!t) return;
  const inp=document.querySelector(t.dataset.eye); if(!inp) return;
  inp.type = inp.type==='password' ? 'text' : 'password';
});

/* ======= Combo de especialidad (id√©ntico flujo a tu referencia) ======= */
(function setupSpecCombo(){
  const wrap=$('#spec-combo'), input=$('#pf-spec'), panel=$('#spec-panel');
  let filtered=ESPECIALIDADES.slice(), open=false, activeIndex=-1;

  function render(list){
    panel.innerHTML='';
    list.forEach((name,idx)=>{
      const div=document.createElement('div');
      div.className='opt'; div.role='option'; div.textContent=name;
      div.setAttribute('aria-selected', idx===activeIndex ? 'true':'false');
      div.addEventListener('mousedown',(e)=>{
        if(!allowEditSpec){ e.preventDefault(); return; }
        e.preventDefault(); e.stopPropagation();
        choose(name);
      });
      panel.appendChild(div);
    });
  }

  function choose(name){
    input.value=name;
    hide(); input.readOnly=true; input.blur();
  }

  function show(){
    if(!allowEditSpec) return;
    wrap.classList.add('show'); open=true;
  }

  function hide(){
    wrap.classList.remove('show'); open=false; activeIndex=-1;
  }

  function syncActive(){
    [...panel.children].forEach((el,i)=>el.setAttribute('aria-selected', i===activeIndex?'true':'false'));
  }

  function filter(q){
    const qq=q.trim().toLowerCase();
    filtered = ESPECIALIDADES.filter(e=>e.toLowerCase().includes(qq));
    activeIndex = filtered.length ? 0 : -1;
    render(filtered); syncActive(); show();
  }

  // Apertura con click en el √°rea
  wrap.addEventListener('mousedown',(e)=>{
    if(!allowEditSpec){ e.preventDefault(); return; }
    if(!open){
      input.readOnly=false; input.focus();
      filtered = ESPECIALIDADES.slice(); activeIndex=0;
      render(filtered); syncActive(); show();
    }
  });

  // B√∫squeda incremental
  input.addEventListener('input',()=>{
    if(input.readOnly || !allowEditSpec) return;
    filter(input.value);
  });

  // Teclado: Enter/Escape/Arriba/Abajo
  input.addEventListener('keydown',(e)=>{
    if(!allowEditSpec) return;
    if(e.key==='ArrowDown'){ if(open && filtered.length){ activeIndex = Math.min(activeIndex+1, filtered.length-1); syncActive(); e.preventDefault(); } }
    else if(e.key==='ArrowUp'){ if(open && filtered.length){ activeIndex = Math.max(activeIndex-1, 0); syncActive(); e.preventDefault(); } }
    else if(e.key==='Enter'){
      if(filtered.length>0){ choose(filtered[Math.max(activeIndex,0)]); e.preventDefault(); }
    }else if(e.key==='Escape'){ hide(); input.readOnly=true; input.blur(); }
  });

  // Clic fuera
  document.addEventListener('mousedown',(e)=>{ if(!wrap.contains(e.target)){ hide(); input.readOnly=true; }});

  // Validaci√≥n estricta al cambiar foco: si no pertenece al cat√°logo, borra
  input.addEventListener('change',()=>{
    const v=input.value.trim();
    if(v && !ESPECIALIDADES.includes(v)) input.value='';
  });

  render(filtered);
})();

/* ======= Guardar y bloquear como en tu referencia ======= */
function profileComplete(){ const p=state.profile||{}; return !!(p.name && p.iddoc && p.spec && ESPECIALIDADES.includes(p.spec)); }

function setProfileReadonly(ro){
  // Los campos de texto quedan ro (readOnly) seg√∫n estado.
  // La especialidad queda bloqueada cuando ro=true, y solo se desbloquea al presionar ‚ÄúModificar‚Äù.
  ['pf-name','pf-id'].forEach(id=>{
    const el=document.getElementById(id);
    el.readOnly=ro; el.style.background=ro?'#eef2ff':'#fff';
  });
  const specInp=$('#pf-spec');
  specInp.readOnly = !allowEditSpec ? true : false;
  specInp.style.background = allowEditSpec ? '#fff' : '#eef2ff';
  $('#btn-edit-profile').style.display = ro ? 'inline-flex':'none';
  $('#btn-save-profile').style.display = ro ? 'none':'inline-flex';
}

function loadIntoForm(){
  $('#pf-name').value = state.profile?.name || '';
  $('#pf-id').value   = state.profile?.iddoc || '';
  $('#pf-spec').value = state.profile?.spec || '';
  allowEditSpec = !profileComplete(); // si ya guard√≥ antes, bloquea hasta ‚ÄúModificar‚Äù
  setProfileReadonly(profileComplete());
}

function saveProfile(){
  const name=($('#pf-name').value||'').trim();
  const iddoc=($('#pf-id').value||'').trim();
  const spec=($('#pf-spec').value||'').trim();
  const pfMsg=$('#pf-msg');

  if(!name||!iddoc||!spec){ pfMsg.textContent='Completa nombre, c√©dula/pasaporte y especialidad.'; return; }
  if(!ESPECIALIDADES.includes(spec)){ pfMsg.textContent='Selecciona una especialidad v√°lida de la lista.'; return; }

  state.profile={name,iddoc,spec};
  pfMsg.classList.add('saving'); pfMsg.textContent='Guardando‚Ä¶';

  // Simula guardado y luego bloquea edici√≥n de especialidad
  setTimeout(()=>{
    pfMsg.classList.remove('saving'); pfMsg.textContent='‚úÖ Perfil guardado.';
    allowEditSpec=false;
    setProfileReadonly(true);
    setTimeout(()=>{ if(pfMsg.textContent.includes('‚úÖ')) pfMsg.textContent=''; },2500);
  },600);
}

document.getElementById('btn-save-profile').addEventListener('click', saveProfile);
document.getElementById('btn-edit-profile').addEventListener('click',()=>{
  allowEditSpec=true;
  setProfileReadonly(false);
  $('#pf-help').textContent='Edita tus datos y guarda los cambios.';
});

// Demo ‚Äúlogin‚Äù para mostrar perfil; puedes reemplazar con tu auth real
document.getElementById('btn-login').addEventListener('click',()=>{
  $('#auth-user').textContent = ($('#login-email').value||'').trim().toLowerCase();
  document.getElementById('step-welcome').style.display='none';
  document.getElementById('profile').style.display='block';
});

loadIntoForm();
</script>
</body>
</html>
